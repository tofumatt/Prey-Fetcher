!RBIX
0
x
M
1
n
n
x
10
__script__
i
31
45
0
1
7
2
65
49
3
2
13
45
0
4
12
7
5
12
7
6
12
65
12
49
7
4
15
48
5
15
2
11
I
6
I
0
I
0
I
0
n
p
8
x
8
Rubinius
n
x
4
Haml
x
11
open_module
n
x
15
__module_init__
M
1
n
n
x
4
Haml
i
32
5
66
45
0
1
7
2
1
65
49
3
3
13
45
0
4
12
7
5
12
7
6
12
65
12
49
7
4
15
48
5
11
I
6
I
0
I
0
I
0
n
p
8
x
8
Rubinius
n
x
6
Buffer
x
10
open_class
n
x
14
__class_init__
M
1
n
n
x
6
Buffer
i
369
5
66
5
45
0
1
43
2
47
49
3
1
15
5
45
0
4
43
5
47
49
3
1
15
5
7
6
47
49
7
1
15
5
7
8
47
49
7
1
15
5
7
9
47
49
7
1
15
5
7
10
47
49
7
1
15
5
7
11
47
49
12
1
15
45
13
14
7
15
7
16
65
67
48
17
49
18
4
15
45
13
19
7
20
7
21
65
67
48
17
49
18
4
15
45
13
22
7
23
7
24
65
67
48
17
49
18
4
15
45
13
25
7
26
7
27
65
67
48
17
49
18
4
15
45
13
28
7
29
7
30
65
67
48
17
49
18
4
15
45
13
31
7
32
7
33
65
67
48
17
49
18
4
15
45
13
34
7
35
7
36
65
67
48
17
49
18
4
15
45
13
37
7
38
7
39
65
67
48
17
49
18
4
15
45
13
40
7
41
7
42
65
67
48
17
49
18
4
15
45
13
43
7
44
7
45
65
67
48
17
49
18
4
15
45
13
46
7
47
7
48
65
67
48
17
49
18
4
15
45
0
49
43
5
5
7
50
7
51
35
1
7
52
7
53
7
54
7
55
7
56
7
57
7
58
7
59
64
49
60
11
15
45
13
61
7
62
7
63
65
67
48
17
49
18
4
15
45
13
64
7
65
7
66
65
67
48
17
49
18
4
15
45
13
67
7
68
7
69
65
5
49
70
4
15
5
47
48
71
15
5
7
72
44
43
73
78
49
74
1
49
75
2
15
45
13
76
7
77
7
78
65
67
48
17
49
18
4
15
45
13
79
7
80
7
81
65
67
48
17
49
18
4
15
45
13
82
7
83
7
84
65
67
48
17
49
18
4
11
I
c
I
0
I
0
I
0
n
p
85
x
4
Haml
n
x
7
Helpers
x
7
include
n
x
4
Util
x
6
buffer
x
13
attr_accessor
x
7
options
x
5
upper
x
16
capture_position
x
6
active
x
11
attr_writer
x
8
Rubinius
n
x
6
xhtml?
M
1
n
n
x
6
xhtml?
i
11
5
47
48
0
10
9
2
8
10
3
11
I
1
I
0
I
0
I
0
n
p
1
x
5
html?
p
5
I
0
I
28
I
0
I
29
I
b
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
x
17
method_visibility
x
15
add_defn_method
n
x
5
html?
M
1
n
n
x
5
html?
i
13
5
47
48
0
13
10
12
15
5
47
48
1
11
I
2
I
0
I
0
I
0
n
p
2
x
6
html4?
x
6
html5?
p
5
I
0
I
2d
I
0
I
2e
I
d
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
6
html4?
M
1
n
n
x
6
html4?
i
12
39
0
7
1
49
2
1
7
3
83
4
11
I
2
I
0
I
0
I
0
n
p
5
x
8
@options
x
6
format
x
2
[]
x
5
html4
x
2
==
p
5
I
0
I
32
I
0
I
33
I
c
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
6
html5?
M
1
n
n
x
6
html5?
i
12
39
0
7
1
49
2
1
7
3
83
4
11
I
2
I
0
I
0
I
0
n
p
5
x
8
@options
x
6
format
x
2
[]
x
5
html5
x
2
==
p
5
I
0
I
37
I
0
I
38
I
c
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
9
toplevel?
M
1
n
n
x
9
toplevel?
i
7
5
47
48
0
48
1
11
I
1
I
0
I
0
I
0
n
p
2
x
5
upper
x
4
nil?
p
5
I
0
I
3d
I
0
I
3e
I
7
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
7
active?
M
1
n
n
x
7
active?
i
3
39
0
11
I
1
I
0
I
0
I
0
n
p
1
x
7
@active
p
5
I
0
I
46
I
0
I
47
I
3
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
10
tabulation
M
1
n
n
x
10
tabulation
i
7
39
0
39
1
81
2
11
I
2
I
0
I
0
I
0
n
p
3
x
10
@real_tabs
x
11
@tabulation
x
1
+
p
5
I
0
I
4b
I
0
I
4c
I
7
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
11
tabulation=
M
1
n
n
x
11
tabulation=
i
24
20
0
39
0
82
1
19
0
15
20
0
77
85
2
9
20
20
0
8
21
78
38
3
11
I
3
I
1
I
1
I
1
n
p
4
x
10
@real_tabs
x
1
-
x
1
>
x
11
@tabulation
p
7
I
0
I
52
I
0
I
53
I
9
I
54
I
18
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
1
x
3
val
n
x
10
initialize
M
1
n
n
x
10
initialize
i
77
23
0
10
8
1
19
0
15
23
1
10
22
44
43
0
78
49
1
1
19
1
15
2
38
2
15
20
0
38
3
15
20
1
38
4
15
5
47
48
5
9
47
7
6
64
8
66
7
6
64
45
7
8
20
1
7
9
49
10
1
49
11
1
49
12
1
38
13
15
78
38
14
15
78
38
15
11
I
6
I
2
I
0
I
2
n
p
16
x
4
Hash
x
16
new_from_literal
x
7
@active
x
6
@upper
x
8
@options
x
8
ruby1_8?
s
0

x
8
Encoding
n
x
8
encoding
x
2
[]
x
4
find
x
6
encode
x
7
@buffer
x
11
@tabulation
x
10
@real_tabs
p
15
I
0
I
5a
I
16
I
5b
I
1a
I
5c
I
1f
I
5d
I
24
I
5e
I
45
I
5f
I
49
I
63
I
4d
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
2
x
5
upper
x
7
options
n
x
9
push_text
M
1
n
n
x
9
push_text
i
76
39
0
78
85
1
9
57
20
0
7
2
13
70
9
28
15
45
3
4
7
5
4
4
49
6
2
6
2
5
47
48
7
49
8
2
15
20
2
9
54
20
0
5
47
48
7
7
9
64
49
10
2
8
55
1
8
58
1
15
39
11
20
0
49
12
1
15
39
13
20
1
81
14
38
13
11
I
7
I
3
I
3
I
3
n
p
15
x
11
@tabulation
x
1
>
n
x
6
Regexp
n
s
9
^(?!\s+$)
x
3
new
x
4
tabs
x
5
gsub!
s
0

x
4
sub!
x
7
@buffer
x
2
<<
x
10
@real_tabs
x
1
+
p
15
I
0
I
6d
I
0
I
6e
I
7
I
72
I
24
I
73
I
39
I
6e
I
3b
I
76
I
43
I
77
I
4c
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
3
x
4
text
x
10
tab_change
x
11
dont_tab_up
n
x
11
adjust_tabs
M
1
n
n
x
11
adjust_tabs
i
9
39
0
20
0
81
1
38
0
11
I
3
I
1
I
1
I
1
n
p
2
x
10
@real_tabs
x
1
+
p
5
I
0
I
7e
I
0
I
7f
I
9
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
1
x
10
tab_change
n
x
13
format_script
x
6
result
x
15
preserve_script
x
6
in_tag
x
12
preserve_tag
x
11
escape_html
x
21
nuke_inner_whitespace
x
12
interpolated
x
4
ugly
s
1979
      <% # Escape HTML here so that the safety of the string is preserved in Rails
         result_name = escape_html ? "html_escape(result.to_s)" : "result.to_s" %>
      <% unless ugly %>
        # If we're interpolated,
        # then the custom tabulation is handled in #push_text.
        # The easiest way to avoid it here is to reset @tabulation.
        <% if interpolated %>
          old_tabulation = @tabulation
          @tabulation = 0
        <% end %>

        tabulation = @real_tabs
        result = <%= result_name %>.<% if nuke_inner_whitespace %>strip<% else %>rstrip<% end %>
      <% else %>
        result = <%= result_name %><% if nuke_inner_whitespace %>.strip<% end %>
      <% end %>

      <% if preserve_tag %>
        result = Haml::Helpers.preserve(result)
      <% elsif preserve_script %>
        result = Haml::Helpers.find_and_preserve(result, options[:preserve])
      <% end %>

      <% if ugly %>
        return result
      <% else %>

        has_newline = result.include?("\n") 
        <% if in_tag && !nuke_inner_whitespace %>
          <% unless preserve_tag %> if !has_newline <% end %>
          @real_tabs -= 1
          <% if interpolated %> @tabulation = old_tabulation <% end %>
          return result
          <% unless preserve_tag %> end <% end %>
        <% end %>

        # Precompiled tabulation may be wrong
        <% if !interpolated && !in_tag %>
          result = tabs + result if @tabulation > 0
        <% end %>

        if has_newline
          result = result.gsub "\n", "\n" + tabs(tabulation)

          # Add tabulation if it wasn't precompiled
          <% if in_tag && !nuke_inner_whitespace %> result = tabs(tabulation) + result <% end %>
        end

        <% if in_tag && !nuke_inner_whitespace %>
          result = "\n#{result}\n#{tabs(tabulation-1)}"
          @real_tabs -= 1
        <% end %>
        <% if interpolated %> @tabulation = old_tabulation <% end %>
        result
      <% end %>

x
17
def_static_method
n
x
8
open_tag
M
1
n
n
x
8
open_tag
i
267
39
0
19
11
15
20
5
19
12
15
20
10
56
1
50
2
0
15
20
8
9
39
5
48
3
20
12
5
20
8
47
49
4
1
49
5
2
8
40
1
15
20
1
13
9
51
15
5
47
48
6
9
74
7
7
64
20
6
9
65
7
8
64
8
68
7
9
64
81
10
19
13
8
121
7
11
64
20
1
13
9
87
15
5
47
48
12
9
93
20
6
8
107
20
2
13
10
107
15
20
3
13
10
107
15
20
7
9
114
7
8
64
8
117
7
9
64
81
10
19
13
15
45
13
14
5
47
48
12
39
15
7
16
49
17
1
20
12
49
18
3
19
12
15
39
19
20
6
13
10
159
15
39
15
7
20
49
17
1
9
166
7
8
64
8
173
5
20
11
47
49
21
1
47
48
22
7
23
20
0
47
48
22
20
12
47
48
22
20
13
47
48
22
63
5
49
24
1
15
20
9
9
244
39
19
20
9
47
48
22
7
25
20
0
47
48
22
7
11
63
4
49
24
1
20
6
9
233
7
8
64
8
236
7
9
64
49
24
1
15
1
11
8
245
1
15
20
1
13
10
254
15
20
7
9
259
1
8
266
39
0
79
81
10
38
0
11
I
14
I
e
I
a
I
a
I
a
p
26
x
10
@real_tabs
M
1
p
2
x
9
for_block
t
n
x
8
open_tag
i
26
57
19
0
15
5
48
0
21
1
12
5
20
0
56
1
50
2
0
47
49
3
1
49
4
2
11
I
7
I
1
I
1
I
1
n
p
5
x
5
class
M
1
p
2
x
9
for_block
t
n
x
8
open_tag
i
20
58
36
37
19
0
15
37
19
1
15
15
20
0
48
0
20
1
35
2
11
I
5
I
2
I
2
I
2
n
p
1
x
4
to_s
p
3
I
0
I
c6
I
14
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
2
x
1
k
x
1
v
x
3
map
x
7
to_hash
x
11
merge_attrs
p
5
I
0
I
c5
I
4
I
c6
I
1a
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
1
x
3
old
x
4
each
x
5
class
x
16
parse_object_ref
x
11
merge_attrs
x
6
xhtml?
s
3
 />
s
0

s
1


x
1
+
s
1
>
x
5
html?
x
11
Precompiler
n
x
8
@options
x
12
attr_wrapper
x
2
[]
x
16
build_attributes
x
7
@buffer
x
4
ugly
x
4
tabs
x
4
to_s
s
1
<
x
2
<<
s
2
</
p
37
I
0
I
c1
I
0
I
c2
I
5
I
c4
I
a
I
c5
I
12
I
c8
I
29
I
ca
I
35
I
cb
I
4a
I
cd
I
59
I
ce
I
5d
I
d0
I
6d
I
d1
I
7a
I
d4
I
90
I
d5
I
c7
I
d7
I
cb
I
d8
I
f0
I
d9
I
f4
I
d7
I
f6
I
dc
I
10b
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
14
x
4
name
x
12
self_closing
x
12
try_one_line
x
12
preserve_tag
x
11
escape_html
x
8
class_id
x
21
nuke_outer_whitespace
x
21
nuke_inner_whitespace
x
7
obj_ref
x
7
content
x
17
attributes_hashes
x
10
tabulation
x
10
attributes
x
3
str
n
x
7
rstrip!
M
1
n
n
x
7
rstrip!
i
49
5
47
48
0
48
1
9
19
5
47
48
2
48
3
15
1
11
8
20
1
15
5
47
48
2
5
47
48
2
44
43
4
5
47
48
0
77
49
5
2
49
6
1
48
7
49
8
1
11
I
5
I
0
I
0
I
0
n
p
9
x
16
capture_position
x
4
nil?
x
6
buffer
x
7
rstrip!
x
5
Range
x
3
new
x
6
slice!
x
6
rstrip
x
2
<<
p
13
I
0
I
e1
I
0
I
e2
I
8
I
e3
I
f
I
e4
I
13
I
e2
I
15
I
e7
I
31
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
n
x
11
merge_attrs
M
1
n
n
x
11
merge_attrs
i
485
20
1
7
0
64
49
1
1
9
41
20
1
7
0
64
45
2
3
20
1
7
0
64
49
1
1
7
4
64
49
5
2
13
18
3
49
6
2
15
8
42
1
15
20
0
7
0
64
49
1
1
13
9
63
15
20
1
7
0
64
49
1
1
9
94
20
0
7
0
64
49
1
1
7
4
64
49
7
1
20
1
7
0
64
49
8
1
48
9
49
7
1
8
154
20
0
7
0
64
49
1
1
13
10
114
15
20
1
7
0
64
49
1
1
9
153
20
1
7
0
64
14
2
49
1
1
13
10
147
15
20
0
7
0
64
49
1
1
13
18
3
49
6
2
15
8
151
18
2
16
2
8
154
1
15
20
1
7
10
64
49
1
1
9
196
20
1
7
10
64
45
2
11
20
1
7
10
64
49
1
1
7
12
64
49
5
2
13
18
3
49
6
2
15
8
197
1
15
20
0
7
10
64
49
1
1
13
9
218
15
20
1
7
10
64
49
1
1
9
275
20
1
7
10
64
20
1
7
10
64
49
1
1
48
9
7
12
64
49
13
1
20
0
7
10
64
49
1
1
7
12
64
49
13
1
49
14
1
48
15
7
12
64
49
16
1
13
18
3
49
6
2
15
8
335
20
0
7
10
64
49
1
1
13
10
295
15
20
1
7
10
64
49
1
1
9
334
20
1
7
10
64
14
2
49
1
1
13
10
328
15
20
0
7
10
64
49
1
1
13
18
3
49
6
2
15
8
332
18
2
16
2
8
335
1
15
20
1
7
17
64
49
1
1
45
18
19
49
20
1
19
2
15
20
0
7
17
64
49
1
1
45
18
21
49
20
1
19
3
15
20
2
13
9
378
15
20
3
9
413
20
0
7
17
64
20
0
7
17
64
49
1
1
20
1
7
17
64
49
1
1
49
22
1
13
18
3
49
6
2
15
8
476
20
3
9
444
45
23
24
43
25
20
0
7
17
64
49
8
1
56
26
50
27
1
20
0
49
22
1
19
0
8
476
20
2
9
475
45
23
28
43
25
20
1
7
17
64
49
8
1
56
29
50
27
1
20
1
49
22
1
19
1
8
476
1
15
20
0
20
1
49
30
1
11
I
9
I
4
I
2
I
2
n
p
31
s
2
id
x
2
[]
x
11
Precompiler
n
s
1
_
x
15
filter_and_join
x
3
[]=
x
2
<<
x
6
delete
x
4
to_s
s
5
class
n
s
1
 
x
5
split
x
1
|
x
4
sort
x
4
join
s
4
data
x
4
Hash
n
x
5
is_a?
n
x
5
merge
x
4
Haml
n
x
4
Util
M
1
p
2
x
9
for_block
t
n
x
11
merge_attrs
i
14
57
19
0
15
7
0
20
0
47
48
1
63
2
11
I
4
I
1
I
1
I
1
n
p
2
s
5
data-
x
4
to_s
p
3
I
0
I
10c
I
e
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
1
x
4
name
x
8
map_keys
n
M
1
p
2
x
9
for_block
t
n
x
11
merge_attrs
i
14
57
19
0
15
7
0
20
0
47
48
1
63
2
11
I
4
I
1
I
1
I
1
n
p
2
s
5
data-
x
4
to_s
p
3
I
0
I
10e
I
e
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
1
x
4
name
x
6
merge!
p
47
I
0
I
f7
I
0
I
f8
I
2b
I
f9
I
41
I
fa
I
5e
I
fb
I
74
I
fc
I
99
I
fb
I
9b
I
ff
I
c6
I
100
I
dc
I
102
I
113
I
103
I
129
I
104
I
14e
I
103
I
150
I
107
I
161
I
108
I
172
I
109
I
17c
I
10a
I
19d
I
10b
I
1a1
I
10c
I
1bc
I
10d
I
1c0
I
10e
I
1db
I
10d
I
1dd
I
111
I
1e5
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
4
x
2
to
x
4
from
x
9
from_data
x
7
to_data
x
13
attach_method
x
7
private
x
11
@@tab_cache
x
4
Hash
x
16
new_from_literal
x
18
class_variable_set
n
x
4
tabs
M
1
n
n
x
4
tabs
i
61
23
0
10
8
78
19
0
15
20
0
39
0
81
1
78
35
2
48
2
19
1
15
65
7
3
49
4
1
20
1
14
2
49
5
1
13
10
56
15
7
6
64
20
1
49
7
1
13
18
3
49
8
2
15
8
60
18
2
16
2
11
I
6
I
2
I
0
I
1
n
p
9
x
11
@tabulation
x
1
+
x
3
max
x
11
@@tab_cache
x
18
class_variable_get
x
2
[]
s
2
  
x
1
*
x
3
[]=
p
7
I
0
I
118
I
8
I
119
I
16
I
11a
I
3d
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
2
x
5
count
x
4
tabs
n
x
16
parse_object_ref
M
1
n
n
x
16
parse_object_ref
i
158
20
0
79
49
0
1
19
1
15
20
0
78
49
0
1
19
0
15
20
0
48
1
9
34
44
43
2
78
49
3
1
11
8
35
1
15
20
0
7
4
49
5
1
9
51
20
0
48
4
8
60
5
20
0
48
6
47
49
7
1
19
2
15
20
2
47
48
8
7
9
20
0
48
10
13
10
81
15
7
11
64
47
48
8
63
3
19
3
15
20
1
9
128
20
1
47
48
8
7
9
20
2
47
48
8
63
3
19
2
15
20
1
47
48
8
7
9
20
3
47
48
8
63
3
19
3
8
129
1
15
44
43
2
80
49
3
1
13
7
12
64
20
3
49
13
2
15
13
7
14
64
20
2
49
13
2
15
11
I
8
I
4
I
1
I
1
n
p
15
x
2
[]
x
4
nil?
x
4
Hash
x
16
new_from_literal
x
15
haml_object_ref
x
11
respond_to?
x
5
class
x
10
underscore
x
4
to_s
s
1
_
x
2
id
s
3
new
s
2
id
x
3
[]=
s
5
class
p
27
I
0
I
121
I
0
I
122
I
9
I
123
I
12
I
125
I
24
I
127
I
2d
I
128
I
33
I
12a
I
3f
I
12c
I
59
I
12d
I
5d
I
12e
I
6e
I
12f
I
80
I
12d
I
82
I
132
I
9e
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
4
x
3
ref
x
6
prefix
x
10
class_name
x
2
id
n
x
10
underscore
M
1
n
n
x
10
underscore
i
88
20
0
48
0
7
1
13
70
9
22
15
45
2
3
7
4
78
49
5
2
6
1
7
6
64
49
7
2
7
8
13
70
9
46
15
45
2
9
7
10
78
49
5
2
6
8
7
11
64
49
7
2
7
12
13
70
9
70
15
45
2
13
7
14
78
49
5
2
6
12
7
11
64
49
7
2
7
15
64
7
6
64
49
16
2
48
17
11
I
5
I
1
I
1
I
1
n
p
18
x
4
to_s
n
x
6
Regexp
n
s
2
::
x
3
new
s
1
_
x
4
gsub
n
n
s
20
([A-Z]+)([A-Z][a-z])
s
5
\1_\2
n
n
s
16
([a-z\d])([A-Z])
s
1
-
x
2
tr
x
8
downcase
p
17
I
0
I
138
I
0
I
139
I
1c
I
13a
I
31
I
139
I
34
I
13b
I
49
I
139
I
4c
I
13c
I
52
I
139
I
58
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
1
x
16
camel_cased_word
p
61
I
2
I
7
I
d
I
8
I
18
I
e
I
20
I
14
I
28
I
1b
I
30
I
21
I
38
I
25
I
40
I
28
I
4f
I
2d
I
5e
I
32
I
6d
I
37
I
7c
I
3d
I
8b
I
46
I
9a
I
4b
I
a9
I
52
I
b8
I
5a
I
c7
I
6d
I
d6
I
7e
I
e5
I
82
I
f1
I
83
I
f9
I
84
I
102
I
82
I
106
I
c1
I
115
I
e1
I
124
I
f7
I
131
I
114
I
136
I
116
I
144
I
118
I
153
I
121
I
162
I
138
I
171
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
x
13
attach_method
p
3
I
2
I
6
I
20
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
x
13
attach_method
p
3
I
0
I
1
I
1f
x
39
/home/nex3/code/haml/lib/haml/buffer.rb
p
0
